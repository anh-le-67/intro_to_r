---
title: "intro to r project"
author: "jodi"
date: "2024-02-22"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, comment = "", warning = FALSE)
```

## 1 Cleaning

In this section, we aim to check for missing and duplicate values and remove columns that are insignificant in our univariate, bivariate and multivariate analysis.

We start off by loading libraries and importing the dataset we will be using for this analysis.

```{r}
library(dplyr)
library(tidyr)
library(tidyverse)
library(ggplot2)
library(gridExtra)
library(lmtest)
library(sandwich)
census_income <- read.csv("adult.csv")
```

```{r}
# Replace '?' elements with NA
census_income <- data.frame(lapply(census_income, function(x) ifelse(x == '?', NA, x)))

# Drop columns native.country, capital.gain, capital.loss, relationship, and education.num
census_income <- subset(census_income, select = -c(native.country, capital.gain, capital.loss, relationship, education.num))

# Remove missing values from the column occupation
census_income <- census_income[complete.cases(census_income$occupation), ]

# Modify the income column to make it 1 if income is above 50k and 0 otherwise
census_income$income <- ifelse(census_income$income == '<=50K', 0, 1)
```

## 2 Basic visualisation

To decide on which variables we will focus on in our analysis, we will run some basic statistical tests on the numerical and categorical variables to understand them better.

```{r}
# Percentage of respondents with income > 50K
income_freq <- table(census_income$income)
barplot(income_freq, 
        main = "Income Distribution", 
        xlab = "Income Category", 
        ylab = "Frequency", 
        ylim = c(0, max(income_freq) + 1))
```
```{r}
# Numerical variables
age_hist <- ggplot(census_income, aes(age)) +
  geom_histogram(binwidth = 0.5)
hours_hist <- ggplot(census_income, aes(hours.per.week)) +
  geom_histogram(binwidth = 3)

grid.arrange(age_hist, hours_hist)
```

```{r}
# Correlation matrix of all numeric variables against income
library(corrplot)
CI_numeric <- census_income[, c("age", "hours.per.week", "income")]
corr_mat <- cor(CI_numeric)
corrplot(corr_mat, method = "number")
```
```{r}
# mean and sd of hours worked per week within the levels of sex
census_income %>%
  group_by(sex) %>%
  summarise(mean_hours_worked = mean(hours.per.week), sd_hours_worked = sd(hours.per.week)) %>%
  mutate(mean = round(mean_hours_worked, 3), sd = round(sd_hours_worked, 3))


# mean and sd of hours worked per week and age within the levels of income
census_income %>%
  group_by(income) %>%
  summarise(mean_hours_worked = mean(hours.per.week), sd_hours_worked = sd(hours.per.week)) %>%
  mutate(mean = round(mean_hours_worked, 3), sd = round(sd_hours_worked, 3))

census_income %>%
  group_by(income) %>%
  summarise(mean_age = mean(age), sd_age = sd(age)) %>%
  mutate(mean = round(mean_age, 3), sd = round(sd_age, 3))
```

```{r}
# descriptive statistics
summary(census_income$hours.per.week)
summary(census_income$age)
sd(census_income$hours.per.week)
sd(census_income$age)
```


## 3 Univariate analysis

```{r}
# regression of individual variables on income
# H0: independent variable has no impact on whether income is above 50K
# H1: independent variable has an impact on whether income is above 50K
linear_age <- lm(income ~ age, census_income)
summary(linear_age)
```

```{r}
linear_sex <- lm(income ~ sex, census_income)
summary(linear_sex)
```

```{r}
linear_race <- lm(income ~ race, census_income)
summary(linear_race)
```

```{r}
linear_hours <- lm(income ~ hours.per.week, census_income)
summary(linear_hours)
```

## 4 Multivariate analysis

```{r}
# linear probability model
lpm <- lm(income ~ age + sex + race + hours.per.week, census_income)
summary(lpm)
```

```{r}
# results with robust standard errors
coeftest(logit, vcov = vcovHC(logit, type="HC1"))
```

## 5 Graphical representations

```{r}
plot(lpm)
```

```{r}
ggplot(census_income, aes(x = hours.per.week, y = income, color = race, shape = sex)) +
  geom_point(position = "jitter", size = 1 )
ggplot(census_income, aes(x = age, y = income, color = race, shape = sex)) +
  geom_point(position = "jitter", size = 1)
```
